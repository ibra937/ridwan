<div class="add-vente-container">

  <h2>Nouvelle Vente</h2>

  <!-- Client -->
  <div class="input-zone">
    <label>Client :</label>
    <input
      type="text"
      [(ngModel)]="client"
      placeholder="Nom du client"
    />
  </div>

  <!-- Recherche produit -->
  <h3>Ajouter un produit</h3>

  <div class="select-zone">

    <input 
      type="text"
      [(ngModel)]="search"
      (input)="filterProduits()"
      placeholder="Rechercher..."
      class="search-input"
    />

    <select [(ngModel)]="selectedProduitId" class="select-product">
      <option value="">-- Sélectionner --</option>

      <option 
        *ngFor="let p of filteredProduits"
        [value]="p.id">
        {{ p.code_produit }} - {{ p.produit }}
      </option>
    </select>

    <button class="btn-add-select" (click)="ajouterProduitDepuisSelect()">
      Ajouter
    </button>

  </div>

  <!-- Liste des produits sélectionnés -->
  <h3>Produits sélectionnés</h3>

  <div *ngFor="let l of lignes; let i = index" class="ligne-vente">

    <div class="infos">
      <strong>{{ l.produit }}</strong>
      <div class="small-meta">{{ l.code_produit }}</div>
    </div>

    <div class="controls">

      <button (click)="changerQuantite(i, -1)">−</button>

      <input
        type="number"
        min="1"
        [(ngModel)]="l.quantite"
        (input)="recalculer()"
      />

      <button (click)="changerQuantite(i, 1)">+</button>

      <span class="total">{{ l.total | number }} FCFA</span>

      <button class="delete-btn" (click)="supprimer(i)">✕</button>
    </div>

  </div>

  <!-- Total -->
  <div class="total-global">
    Total : <strong>{{ totalVente | number }} FCFA</strong>
  </div>

  <!-- Enregistrer -->
  <button class="submit-btn" (click)="ouvrirConfirmation()">
    Enregistrer la vente
  </button>

</div>

<!-- Popup -->
<div *ngIf="popup" class="popup-backdrop">
  <div class="popup">
    <p>Confirmer l’enregistrement de la vente ?</p>
    <div class="popup-actions">
      <button class="cancel" (click)="fermerPopup()">Annuler</button>
      <button class="confirm" (click)="validerVente()">Confirmer</button>
    </div>
  </div>
</div>

<!-- Loader -->
<div *ngIf="loading" class="loader-backdrop">
  <div class="loader"></div>
</div>
